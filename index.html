<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Daily Expense Tracker</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <style>
        body {
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif;
            margin: 24px;
            background: #fff;
            color: #000;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        h1 { font-size: 20px; margin: 0; }
        form.inline { display: inline-flex; gap: 8px; align-items: center; }
        input, select, button { padding: 8px; font-size: 14px; }
        table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        th, td { border-bottom: 1px solid #eee; padding: 8px; text-align: left; }
        th { background: #fafafa; }
        tfoot td { font-weight: bold; }
        .row-actions { display: flex; gap: 8px; }
        .delete { color: #b00020; }
        .grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
        .grid > * { min-width: 0; }
        .muted { color: #666; font-size: 12px; }

        /* ðŸŒ™ DARK MODE (PURE BLACK THEME) */
        html.dark, html.dark body { background-color: #000 !important; color: #fff !important; }
        html.dark header { background-color: #000; border-bottom: 1px solid #222; }
        html.dark h1, html.dark h2, html.dark label { color: #fff; }
        html.dark input, html.dark select, html.dark button, html.dark table, html.dark th, html.dark td {
            background-color: #111; color: #fff; border-color: #222;
        }
        html.dark button { background-color: #222; border: 1px solid #333; color: #fff; }
        html.dark button:hover { background-color: #333; }
        html.dark .delete { color: #ff4c4c; }
        html.dark table { border-color: #222; }
        html.dark th { background-color: #111; }
        html.dark tr:nth-child(even) { background-color: #0a0a0a; }
        html.dark section { background-color: #000; color: #fff; }
        html.dark .muted { color: #aaa; }
        html.dark a { color: #1e90ff; }
        html.dark a:hover { text-decoration: underline; }
        html.dark section[style*="background:#f5f5f5"],
        html.dark section[style*="background:#eef7ff"] {
            background: #0a0a0a !important; color: #fff !important;
        }
    </style>
    <script>
        function goToDate() {
            const d = document.getElementById('datePick').value;
            const url = new URL(window.location);
            if (d) { url.searchParams.set('date', d); } else { url.searchParams.delete('date'); }
            window.location = url.toString();
        }
        function toggleDark() {
            const enabled = localStorage.getItem('dark') === '1';
            const next = !enabled;
            localStorage.setItem('dark', next ? '1' : '0');
            document.documentElement.classList.toggle('dark', next);
        }
        document.addEventListener('DOMContentLoaded', () => {
            const enabled = localStorage.getItem('dark') === '1';
            document.documentElement.classList.toggle('dark', enabled);
        });
    </script>
</head>
<body>
    <header>
        <h1>Daily Expense Tracker</h1>
        <form class="inline" onsubmit="event.preventDefault(); goToDate();">
            <label for="datePick">Date</label>
            <input id="datePick" type="date" value="{{ entry_date }}" />
            <button type="submit">Go</button>
        </form>
        <button onclick="toggleDark()" style="margin-left:8px;">Dark Mode</button>
    </header>

    <section>
        <h2 style="font-size:16px;margin:0 0 8px 0;">Add Item</h2>
        <form method="post" action="/add">
            <input type="hidden" name="entry_date" value="{{ entry_date }}" />
            <div class="grid">
                <input type="text" name="item_name" placeholder="Item name" required />
                <input type="number" name="unit_price" placeholder="Price" step="0.01" min="0" required />
                <button type="submit">Add</button>
            </div>
        </form>
    </section>

    <section>
        <h2 style="font-size:16px;margin:16px 0 8px 0;">Add Fixed Expense (Rent/Bills)</h2>
        <form method="post" action="/add">
            <input type="hidden" name="entry_date" value="{{ entry_date }}" />
            <input type="hidden" name="item_type" value="fixed" />
            <input type="hidden" name="quantity" value="1" />
            <div class="grid">
                <input type="text" name="item_name" placeholder="Fixed item name (e.g., Rent)" required />
                <div style="align-self:center;">Amount</div>
                <input type="number" name="unit_price" placeholder="Amount" step="0.01" min="0" required />
                <div class="muted" style="align-self:center;">Quantity fixed to 1</div>
                <div></div>
                <button type="submit">Add Fixed</button>
            </div>
        </form>
    </section>

    <section>
        <h2 style="font-size:16px;margin:16px 0 8px 0;">Fixed Expenses (Bills/Rent) â€” {{ month_label }}</h2>
        <table>
            <thead>
                <tr>
                    <th>Item</th>
                    <th>Amount</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for item in fixed_items %}
                <tr>
                    <td>{{ item.item_name }}</td>
                    <td>{{ '%.2f'|format(item.line_total) }}</td>
                    <td>
                        <form method="post" action="/delete/{{ item.id }}">
                            <input type="hidden" name="entry_date" value="{{ entry_date }}" />
                            <button class="delete" type="submit" onclick="return confirm('Delete this item?');">Delete</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="color:#666;">No fixed expenses yet.</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td style="text-align:right;font-weight:bold;">Fixed Total:</td>
                    <td style="font-weight:bold;">{{ '%.2f'|format(fixed_total) }}</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </section>

    <!-- ðŸ”» Daily Expenses shows ONLY Unit Price and Line Total (plus Delete) -->
    <section>
        <h2 style="font-size:16px;margin:16px 0 8px 0;">Daily Expenses for {{ entry_date }}</h2>
        <table>
            <thead>
                <tr>
                    <th>Unit Price</th>
                    <th>Line Total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for item in daily_items %}
                <tr>
                    <td>{{ '%.2f'|format(item.unit_price) }}</td>
                    <td>{{ '%.2f'|format(item.line_total) }}</td>
                    <td>
                        <form method="post" action="/delete/{{ item.id }}">
                            <input type="hidden" name="entry_date" value="{{ entry_date }}" />
                            <button class="delete" type="submit" onclick="return confirm('Delete this item?');">Delete</button>
                        </form>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="3" style="color:#666;">No daily expenses yet.</td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td style="text-align:right;font-weight:bold;">Daily Total:</td>
                    <td style="font-weight:bold;">{{ '%.2f'|format(daily_total) }}</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </section>

    <section style="margin-top:24px;padding:16px;background:#f5f5f5;border-radius:8px;">
        <h2 style="font-size:18px;margin:0 0 8px 0;">Grand Total (Daily) for {{ entry_date }}</h2>
        <div style="font-size:24px;font-weight:bold;color:#1976d2;">{{ '%.2f'|format(daily_total) }}</div>
    </section>

    <section style="margin-top:16px;padding:16px;background:#eef7ff;border-radius:8px;display:flex;justify-content:space-between;align-items:center;gap:12px;">
        <h2 style="font-size:18px;margin:0 0 8px 0;">Grand Total for {{ month_label }}</h2>
        <div style="font-size:20px;font-weight:bold;color:#0d47a1;">{{ '%.2f'|format(month_total) }}</div>
        <a href="/download/month?date={{ entry_date }}" style="text-decoration:none;background:#1976d2;color:#fff;padding:8px 12px;border-radius:6px;">Download CSV</a>
        <div class="muted" style="margin-left:auto;">Includes all expenses in the selected date's month.</div>
    </section>
</body>
</html>
